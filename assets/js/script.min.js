let rows=10,cols=10,totalMines=15,board=[],gameOver=!1,gameWon=!1,flagsPlaced=0,tagsPlaced=0,tagMode=!1,soundEnabled=!0;const gameBoard=document.getElementById("game-board"),restartBtn=document.getElementById("restart-btn"),tagToggleBtn=document.getElementById("tag-toggle"),soundToggleBtn=document.getElementById("sound-toggle"),minesCount=document.getElementById("mines-count"),flagsCount=document.getElementById("flags-count"),tagsCount=document.getElementById("tags-count"),messageEl=document.getElementById("message"),difficultySelect=document.getElementById("difficulty"),clickSound=document.getElementById("click-sound"),flagSound=document.getElementById("flag-sound"),winSound=document.getElementById("win-sound"),loseSound=document.getElementById("lose-sound"),revealSound=document.getElementById("reveal-sound");function setDifficulty(e){"easy"===e?(rows=8,cols=8,totalMines=10):"medium"===e?(rows=10,cols=10,totalMines=15):"hard"===e&&(rows=16,cols=16,totalMines=40),gameBoard.style.gridTemplateColumns=`repeat(${cols}, 35px)`,gameBoard.style.gridTemplateRows=`repeat(${rows}, 35px)`}function showMessage(e,t=""){messageEl.textContent=e,messageEl.className=t}function generateBoard(){messageEl.textContent="",gameOver=!1,gameWon=!1,flagsPlaced=0,tagsPlaced=0,board=Array.from({length:rows},()=>Array.from({length:cols},()=>({mine:!1,flagged:!1,tagged:!1,opened:!1,adjacentMines:0}))),placeMines(),calculateAdjacentMines(),renderBoard(),updateCounters()}function placeMines(){let e=0;for(;e<totalMines;){let t=Math.floor(Math.random()*rows),n=Math.floor(Math.random()*cols);!board[t][n].mine&&(board[t][n].mine=!0,e++)}}function calculateAdjacentMines(){let e=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];for(let t=0;t<rows;t++)for(let n=0;n<cols;n++){if(board[t][n].mine)continue;let a=0;for(let[o,d]of e){let l=t+o,s=n+d;l>=0&&l<rows&&s>=0&&s<cols&&board[l][s].mine&&a++}board[t][n].adjacentMines=a}}function renderBoard(){gameBoard.innerHTML="";for(let e=0;e<rows;e++)for(let t=0;t<cols;t++){let n=document.createElement("div");n.classList.add("tile"),n.dataset.row=e,n.dataset.col=t,board[e][t].opened?(n.classList.add("opened"),board[e][t].mine?(n.classList.add("mine"),n.textContent="\uD83D\uDCA3"):board[e][t].adjacentMines>0&&(n.textContent=board[e][t].adjacentMines,n.classList.add(`number-${board[e][t].adjacentMines}`))):board[e][t].flagged?(n.classList.add("flagged"),n.textContent="\uD83D\uDEA9"):board[e][t].tagged&&(n.classList.add("question"),n.textContent="?"),gameOver||gameWon||(n.addEventListener("click",()=>handleClick(e,t)),n.addEventListener("contextmenu",n=>handleRightClick(n,e,t))),gameBoard.appendChild(n)}gameOver?gameBoard.classList.add("game-over"):gameWon?gameBoard.classList.add("win"):gameBoard.classList.remove("game-over","win")}function handleClick(e,t){gameOver||gameWon||board[e][t].opened||board[e][t].flagged||(playSound(revealSound),board[e][t].opened=!0,board[e][t].mine?(gameOver=!0,playSound(loseSound),revealAllMines(),renderBoard(),showMessage("\uD83D\uDCA5 Game Over! Click restart to try again.","lose")):(0===board[e][t].adjacentMines&&openAdjacentCells(e,t),checkWinCondition(),renderBoard()))}function handleRightClick(e,t,n){e.preventDefault(),gameOver||gameWon||board[t][n].opened||(tagMode?(board[t][n].tagged?(board[t][n].tagged=!1,tagsPlaced--):!board[t][n].flagged&&(board[t][n].tagged=!0,tagsPlaced++),playSound(clickSound)):(board[t][n].flagged?(board[t][n].flagged=!1,flagsPlaced--):!board[t][n].tagged&&(board[t][n].flagged=!0,flagsPlaced++),playSound(flagSound)),updateCounters(),renderBoard())}function openAdjacentCells(e,t){for(let[n,a]of[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]]){let o=e+n,d=t+a;o>=0&&o<rows&&d>=0&&d<cols&&!board[o][d].opened&&!board[o][d].flagged&&(board[o][d].opened=!0,0===board[o][d].adjacentMines&&openAdjacentCells(o,d))}}function checkWinCondition(){let e=!0;for(let t=0;t<rows;t++){for(let n=0;n<cols;n++)if(!board[t][n].mine&&!board[t][n].opened){e=!1;break}if(!e)break}e&&(gameWon=!0,playSound(winSound),showMessage("\uD83C\uDF89 Congratulations! You won!","win"))}function revealAllMines(){for(let e=0;e<rows;e++)for(let t=0;t<cols;t++)board[e][t].mine&&(board[e][t].opened=!0)}function updateCounters(){minesCount.textContent=totalMines-flagsPlaced,flagsCount.textContent=flagsPlaced,tagsCount.textContent=tagsPlaced}function playSound(e){if(!soundEnabled)return;let t=e.cloneNode();t.volume=.7,t.play().catch(()=>{})}function toggleTagMode(){tagMode=!tagMode,tagToggleBtn.textContent=`Tag Mode: ${tagMode?"On":"Off"}`,playSound(clickSound)}function toggleSound(){soundEnabled=!soundEnabled,soundToggleBtn.textContent=`Sound: ${soundEnabled?"On":"Off"}`,soundToggleBtn.classList.toggle("sound-on",soundEnabled),soundToggleBtn.classList.toggle("sound-off",!soundEnabled),soundEnabled&&playSound(clickSound)}restartBtn.addEventListener("click",()=>{playSound(clickSound),setDifficulty(difficultySelect.value),generateBoard()}),tagToggleBtn.addEventListener("click",toggleTagMode),soundToggleBtn.addEventListener("click",toggleSound),difficultySelect.addEventListener("change",e=>{setDifficulty(e.target.value),generateBoard()}),setDifficulty(difficultySelect.value),generateBoard();